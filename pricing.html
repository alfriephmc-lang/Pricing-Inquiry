<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pricing Inquiry</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
  --corp-green:#007941;
  --corp-light:#10b981;
  --glass-bg:rgba(255,255,255,0.08);
  --glass-border:rgba(255,255,255,0.2);
}
body{
  margin:0;overflow:hidden;
  background:radial-gradient(circle,#064e3b,#022c22);
  font-family:system-ui;
  display:flex;justify-content:center;align-items:center;
  min-height:100vh;
}
.glass-card{
  width:95%;max-width:900px;
  background:var(--glass-bg);
  backdrop-filter:blur(20px);
  border:1px solid var(--glass-border);
  border-radius:2.5rem;
  padding:2rem;
  box-shadow:0 25px 50px -12px rgba(0,0,0,.5);
}
input{
  background:rgba(0,0,0,.25)!important;
  border:1px solid rgba(255,255,255,.1)!important;
  color:white!important;
}
input:focus{
  border-color:var(--corp-light)!important;
  box-shadow:0 0 10px rgba(16,185,129,.4)!important;
}
</style>
</head>

<body>

<div class="glass-card">

<!-- HEADER -->
<div class="flex justify-between items-center mb-6">
  <div class="flex items-center gap-3">
    <img src="https://i.imgur.com/VbZKWAf.png" class="h-10">
    <div>
      <h2 class="text-white font-bold">Pricing Inquiry</h2>
      <p class="text-emerald-400 text-[10px] uppercase tracking-widest">Hospital Database</p>
    </div>
  </div>
  <button onclick="logout()" class="text-xs bg-red-500/80 hover:bg-red-500 px-3 py-2 rounded-lg text-white">
    Logout
  </button>
</div>

<!-- SEARCH -->
<input id="search" placeholder="Search item code or description..."
class="w-full px-4 py-3 rounded-xl mb-5 text-sm">

<!-- TABLE -->
<div class="overflow-auto max-h-[60vh]">
<table class="w-full text-white text-sm">
<thead>
<tr class="text-emerald-400 border-b border-white/10">
  <th class="py-2 text-left">Item Code</th>
  <th>Description</th>
  <th>Price</th>
  <th>Remarks</th>
</tr>
</thead>
<tbody id="table-body"></tbody>
</table>
</div>

</div>

<script>
const supabase = window.supabase.createClient(
  'https://yheciygtsimcduzeavlq.supabase.co',
  'sb_publishable_4SRJECxF1Sr9jc7GwB5vYQ_cZut4BWG'
);

let allData = [];

async function loadData() {
  console.log("Fetching data...");
  const { data, error } = await supabase
    .from('pricing_database')
    .select('*')
    .order('item_code');

  if (error) {
    console.error("Supabase Error:", error);
    alert("Error fetching data: " + error.message);
    return;
  }

  console.log("Data received:", data); // Check your browser console (F12) to see if data arrived
  allData = data || [];
  render(allData);
}

function render(rows) {
  const body = document.getElementById('table-body');
  if (!rows || rows.length === 0) {
    body.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-400">No items found</td></tr>';
    return;
  }

  // Use map for faster rendering and added safety checks
  body.innerHTML = rows.map(r => `
    <tr class="border-b border-white/5 hover:bg-white/5">
      <td class="py-2 px-2">${r.item_code || 'N/A'}</td>
      <td class="px-2">${r.item_description || 'No Description'}</td>
      <td class="px-2">â‚±${r.price ? Number(r.price).toLocaleString() : '0'}</td>
      <td class="px-2">${r.remarks || ''}</td>
    </tr>
  `).join('');
}

/* SEARCH */
document.getElementById('search').addEventListener('input', e => {
  const q = e.target.value.toLowerCase().trim();
  
  const filtered = allData.filter(r => {
    // String() ensures that if a code is a number, it doesn't crash
    const code = String(r.item_code || '').toLowerCase();
    const desc = String(r.item_description || '').toLowerCase();
    return code.includes(q) || desc.includes(q);
  });
  
  render(filtered);
});

/* AUTH GUARD & INITIALIZE */
async function checkAuth() {
  const { data: { session } } = await supabase.auth.getSession();
  if (!session) {
    console.log("No session found, redirecting...");
    // location.href = "index.html"; // Uncomment this when ready
  } else {
    loadData();
  }
}

checkAuth();
</script>

</body>
</html>


